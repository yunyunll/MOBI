.data

.text
.globl _asm_main
.globl _asm_sum

_asm_main:
    stp x29, x30, [sp, #-16]!
    mov x29, sp

    // push 1
    mov w0, #1
    str w0, [sp, #-16]!

    // push 2
    mov w0, #2
    str w0, [sp, #-16]!

    bl _asm_sum

    add sp, sp, #32          // 두 값 pop

    ldp x29, x30, [sp], #16
    ret

//-------------------------------------------------------

_asm_sum:
    // 스택 프레임 만들기
    stp x29, x30, [sp, #-16]!
    mov x29, sp

    //-----------------------------------------
    // 지역 변수 2개(x,y) 공간 16바이트 확보
    //-----------------------------------------
    sub sp, sp, #16

    // x = 100
    mov w0, #100
    str w0, [sp]

    // y = 200
    mov w1, #200
    str w1, [sp, #8]
    //-----------------------------------------

    // 스택에서 _asm_main이 push한 값 읽기
    ldr w1, [x29, #16]        // 2
    ldr w2, [x29, #32]        // 1
    add w0, w1, w2            // w0 = 3

    //-----------------------------------------
    // x,y 변수를 pop (16바이트 free)
    //-----------------------------------------
    add sp, sp, #16

    // 함수 프레임 해제
    ldp x29, x30, [sp], #16
    ret
